<!DOCTYPE html>
<html lang="ja">

<head>
    <script>
        // GA4 Tag: Only active on production domain
        if (window.location.hostname === "creators-box.net") {
            var script = document.createElement('script');
            script.async = true;
            script.src = "https://www.googletagmanager.com/gtag/js?id=G-WXMCP3D8W6";
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-WXMCP3D8W6');
        } else {
            console.log("GA4: ãƒ­ãƒ¼ã‚«ãƒ«/ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã®ãŸã‚è¨ˆæ¸¬ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ");
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Death-Line Calculator | CPOæç›Šåˆ†å²ç‚¹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <meta name="description" content="LTVã¨ã‚³ã‚¹ãƒˆæ§‹é€ ã‹ã‚‰ã€ãƒ“ã‚¸ãƒã‚¹ãŒèµ¤å­—è»¢è½ã™ã‚‹ã€Œé™ç•ŒCPOï¼ˆæ’¤é€€ãƒ©ã‚¤ãƒ³ï¼‰ã€ã‚’ç®—å‡ºã€‚ç¾åœ¨ã®åºƒå‘Šé‹ç”¨ãŒå®‰å…¨åœã‹å±é™ºæ°´åŸŸã‹ã‚’å¯è¦–åŒ–ã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€‚">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            850: '#1e293b',
                        }
                    }
                },
            },
        }
    </script>
    <style>
        /* Custom styles for range inputs if needed */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 min-h-screen font-sans">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-30">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <a href="../../index.html" class="flex items-center gap-2 group">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                    class="text-slate-400 group-hover:text-blue-600 transition-colors">
                    <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <span class="font-bold text-slate-700 group-hover:text-slate-900 transition-colors">Creators Box</span>
            </a>
            <h1 class="text-lg font-bold text-slate-900 hidden md:block">The Death-Line Calculator</h1>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 md:py-12 max-w-6xl">

        <div class="mb-8">
            <h1 class="text-2xl md:text-3xl font-extrabold text-slate-900 mb-2">The Death-Line Calculator</h1>
            <p class="text-slate-600">æ’¤é€€ãƒ©ã‚¤ãƒ³ï¼ˆé™ç•ŒCPOï¼‰ã‚’å¯è¦–åŒ–ã™ã‚‹æç›Šåˆ†å²ç‚¹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- Input Area -->
            <div class="lg:col-span-5 bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8 h-fit">
                <h2 class="text-lg font-bold text-slate-900 mb-6 flex items-center gap-2">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="text-blue-600">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
                </h2>

                <div class="space-y-6">
                    <!-- LTV Input -->
                    <div>
                        <label for="ltv" class="block text-sm font-semibold text-slate-700 mb-2">LTV (é¡§å®¢ç”Ÿæ¶¯ä¾¡å€¤)</label>
                        <div class="relative">
                            <input type="number" id="ltv" value="10000"
                                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-lg"
                                placeholder="10000">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">å††</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">1äººã®é¡§å®¢ãŒç”Ÿæ¶¯ã§ã‚‚ãŸã‚‰ã™å¹³å‡å£²ä¸Š</p>
                    </div>

                    <!-- Variable Cost Ratio Input -->
                    <div>
                        <label for="variableRate"
                            class="block text-sm font-semibold text-slate-700 mb-2">åŸä¾¡ç‡ãƒ»å¤‰å‹•è²»ç‡</label>
                        <div class="relative">
                            <input type="number" id="variableRate" value="30"
                                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-lg"
                                placeholder="30">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">%</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">å£²ä¸Šã«å¯¾ã™ã‚‹åŸä¾¡ã€æ±ºæ¸ˆæ‰‹æ•°æ–™ã€é€æ–™ãªã©ã®å‰²åˆ</p>
                    </div>

                    <!-- Current CPO Input -->
                    <div>
                        <label for="currentCpo" class="block text-sm font-semibold text-slate-700 mb-2">ç¾åœ¨ã®CPO
                            (é¡§å®¢ç²å¾—å˜ä¾¡)</label>
                        <div class="relative">
                            <input type="number" id="currentCpo" value="3000"
                                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-lg"
                                placeholder="3000">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">å††</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">ç¾åœ¨ã€1ä»¶ã®ç²å¾—ã«ã‹ã‹ã£ã¦ã„ã‚‹åºƒå‘Šã‚³ã‚¹ãƒˆ</p>
                    </div>

                    <!-- Target Profit Ratio Input -->
                    <div>
                        <label for="targetProfitRate" class="block text-sm font-semibold text-slate-700 mb-2">ç›®æ¨™åˆ©ç›Šç‡
                            (ä»»æ„)</label>
                        <div class="relative">
                            <input type="number" id="targetProfitRate" value="20"
                                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-lg"
                                placeholder="20">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">%</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">æœ€ä½é™ç¢ºä¿ã—ãŸã„åˆ©ç›Šç‡ï¼ˆæ¨å¥¨ãƒ©ã‚¤ãƒ³è¨ˆç®—ç”¨ï¼‰</p>
                    </div>
                </div>
            </div>

            <!-- Result Area -->
            <div class="lg:col-span-7 space-y-6">

                <!-- Status Card -->
                <div id="statusCard"
                    class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8 flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden transition-colors duration-300">
                    <div class="flex-1 z-10">
                        <span class="text-sm font-bold tracking-wider uppercase opacity-70 mb-1 block"
                            id="statusLabel">Analysing...</span>
                        <h3 class="text-3xl md:text-4xl font-extrabold" id="statusText">---</h3>
                        <p class="mt-2 text-sm opacity-90" id="statusMessage">æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                    </div>
                    <!-- Icon placeholder -->
                    <div class="z-10 bg-white/20 p-4 rounded-full backdrop-blur-sm">
                        <span class="text-4xl" id="statusIcon">ğŸ¤”</span>
                    </div>
                    <!-- Background decor -->
                    <div
                        class="absolute right-0 top-0 w-64 h-64 bg-current opacity-5 rounded-full -translate-y-1/2 translate-x-1/2 pointer-events-none">
                    </div>
                </div>

                <!-- Lines Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Death Line -->
                    <div class="bg-white rounded-xl shadow-sm border border-red-100 p-5 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-24 h-24 bg-red-100 rounded-bl-full -mr-8 -mt-8 opacity-50">
                        </div>
                        <h4 class="text-sm font-bold text-red-600 mb-1">é™ç•ŒCPO (Death Line)</h4>
                        <div class="text-2xl font-bold text-slate-800 font-mono"><span id="deathLineCpo">0</span><span
                                class="text-sm font-normal text-slate-500 ml-1">å††</span></div>
                        <p class="text-xs text-slate-500 mt-2">ã“ã‚Œä»¥ä¸Šã‹ã‘ã‚‹ã¨èµ¤å­—ã«ãªã‚‹ãƒ©ã‚¤ãƒ³</p>
                    </div>

                    <!-- Profit Line -->
                    <div class="bg-white rounded-xl shadow-sm border border-emerald-100 p-5 relative overflow-hidden">
                        <div
                            class="absolute top-0 right-0 w-24 h-24 bg-emerald-100 rounded-bl-full -mr-8 -mt-8 opacity-50">
                        </div>
                        <h4 class="text-sm font-bold text-emerald-600 mb-1">æ¨å¥¨CPO (Profit Line)</h4>
                        <div class="text-2xl font-bold text-slate-800 font-mono"><span id="profitLineCpo">0</span><span
                                class="text-sm font-normal text-slate-500 ml-1">å††</span></div>
                        <p class="text-xs text-slate-500 mt-2">ç›®æ¨™åˆ©ç›Šã‚’é”æˆã§ãã‚‹ä¸Šé™ã‚³ã‚¹ãƒˆ</p>
                    </div>
                </div>

                <!-- Chart -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                    <h3 class="font-bold text-slate-800 mb-4">åæ”¯æ§‹é€ ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«</h3>
                    <div class="h-64 md:h-80 w-full">
                        <canvas id="profitChart"></canvas>
                    </div>
                    <div class="mt-4 flex flex-wrap gap-4 text-xs text-slate-500 justify-center">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-slate-200"></span>å¤‰å‹•è²»
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-blue-500"></span>ç¾åœ¨CPO
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-emerald-400"></span>æ®‹åˆ©ç›Š
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white py-8 border-t border-slate-200 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-slate-500 text-sm mb-4">
                â€»ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã¯ç›®å®‰ã§ã™ã€‚å®Ÿéš›ã®çµŒå–¶åˆ¤æ–­ã¯å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚<br>
                ãƒ‡ãƒ¼ã‚¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã•ã‚Œã€å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚
            </p>
            <p class="text-slate-400 text-xs">&copy; 2025 Creators Box</p>
        </div>
    </footer>

    <script>
        // DOM Elements
        const inputs = {
            ltv: document.getElementById('ltv'),
            variableRate: document.getElementById('variableRate'),
            currentCpo: document.getElementById('currentCpo'),
            targetProfitRate: document.getElementById('targetProfitRate')
        };

        const outputs = {
            card: document.getElementById('statusCard'),
            label: document.getElementById('statusLabel'),
            text: document.getElementById('statusText'),
            message: document.getElementById('statusMessage'),
            icon: document.getElementById('statusIcon'),
            deathLine: document.getElementById('deathLineCpo'),
            profitLine: document.getElementById('profitLineCpo')
        };

        let chart = null;

        // Formats
        const formatCurrency = (num) => new Intl.NumberFormat('ja-JP').format(Math.round(num));

        // Calculation Logic
        function calculate() {
            const ltv = parseFloat(inputs.ltv.value) || 0;
            const variableRate = parseFloat(inputs.variableRate.value) || 0;
            const currentCpo = parseFloat(inputs.currentCpo.value) || 0;
            const targetProfitRate = parseFloat(inputs.targetProfitRate.value) || 0;

            // Basic Calcs
            const variableCost = ltv * (variableRate / 100);
            const targetProfitAmount = ltv * (targetProfitRate / 100);

            // Lines
            const deathLineCpo = ltv - variableCost; // Break-even CPO
            const profitLineCpo = ltv - variableCost - targetProfitAmount; // Target CPO

            // Profit Calculation
            const currentTotalCost = variableCost + currentCpo;
            const currentProfit = ltv - currentTotalCost;

            updateUI(ltv, variableCost, currentCpo, currentProfit, deathLineCpo, profitLineCpo, targetProfitAmount);
            updateChart(ltv, variableCost, currentCpo, currentProfit);
        }

        function updateUI(ltv, variableCost, currentCpo, currentProfit, deathLineCpo, profitLineCpo, targetProfitAmount) {
            // Update Number Displays
            outputs.deathLine.textContent = formatCurrency(deathLineCpo);
            outputs.profitLine.textContent = formatCurrency(profitLineCpo);

            // Determine Status
            let status = '';

            // Remove previous color classes
            outputs.card.className = "bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8 flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden transition-colors duration-300";

            if (currentCpo > deathLineCpo) {
                // DANGER: Deficit
                status = 'DANGER';
                outputs.card.classList.add('bg-red-50', 'border-red-200', 'text-red-900');
                outputs.label.textContent = "Current Status";
                outputs.text.textContent = "DANGER";
                outputs.message.textContent = `èµ¤å­—ç™ºç”Ÿä¸­ï¼1ä»¶ç²å¾—ã”ã¨ã« ${formatCurrency(Math.abs(currentProfit))}å†† ã®æå¤±ã§ã™ã€‚å³æ™‚æ’¤é€€ã‹LTVæ”¹å–„ãŒå¿…è¦ã§ã™ã€‚`;
                outputs.icon.textContent = "ğŸ˜±";
            } else if (currentCpo > profitLineCpo) {
                // WARNING: Profitable but below target
                status = 'WARNING';
                outputs.card.classList.add('bg-amber-50', 'border-amber-200', 'text-amber-900');
                outputs.label.textContent = "Current Status";
                outputs.text.textContent = "WARNING";
                outputs.message.textContent = `é»’å­—ã§ã™ãŒç›®æ¨™åˆ©ç›Šç‡(${inputs.targetProfitRate.value}%)ã‚’ä¸‹å›ã£ã¦ã„ã¾ã™ã€‚åˆ©ç›Šåœ§è¿«ã®æ‡¸å¿µãŒã‚ã‚Šã¾ã™ã€‚`;
                outputs.icon.textContent = "âš ï¸";
            } else {
                // EXCELLENT: Meeting target
                status = 'EXCELLENT';
                outputs.card.classList.add('bg-indigo-50', 'border-indigo-200', 'text-indigo-900');
                outputs.label.textContent = "Current Status";
                outputs.text.textContent = "EXCELLENT";
                outputs.message.textContent = `ç´ æ™´ã‚‰ã—ã„ï¼ç›®æ¨™åˆ©ç›Šã‚’ç¢ºä¿ã§ãã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã‚¢ã‚¯ã‚»ãƒ«ã‚’è¸ã‚ã‚‹çŠ¶æ…‹ã§ã™ã€‚`;
                outputs.icon.textContent = "ğŸš€";
            }
        }

        function updateChart(ltv, variableCost, currentCpo, currentProfit) {
            const ctx = document.getElementById('profitChart').getContext('2d');

            // Data prep
            // To visualize nicely, if profit is negative (loss), we show red bar extending beyond LTV?
            // Or simple stacked bar of LTV breakdown.

            // Approach: Stacked Bar. 
            // Bar 1: Total Revenue (LTV)
            // Bar 2: Costs Stack (Variable + CPO + Profit/Loss)

            let profitBarValue = currentProfit > 0 ? currentProfit : 0;
            let lossBarValue = currentProfit < 0 ? Math.abs(currentProfit) : 0;

            const data = {
                labels: ['LTV (å£²ä¸Š)', 'ã‚³ã‚¹ãƒˆæ§‹é€ '],
                datasets: [
                    {
                        label: 'LTV / å¤‰å‹•è²»',
                        data: [ltv, variableCost],
                        backgroundColor: '#e2e8f0', // slate-200
                        borderRadius: 4,
                        stack: 'stack1'
                    },
                    {
                        label: 'åºƒå‘Šè²» (CPO)',
                        data: [0, currentCpo],
                        backgroundColor: '#3b82f6', // blue-500
                        borderRadius: 4,
                        stack: 'stack1'
                    },
                    {
                        label: 'åˆ©ç›Š',
                        data: [0, profitBarValue],
                        backgroundColor: '#34d399', // emerald-400
                        borderRadius: 4,
                        stack: 'stack1'
                    },
                    {
                        label: 'èµ¤å­—',
                        data: [0, lossBarValue], // Shows on top if loss
                        backgroundColor: '#ef4444', // red-500
                        borderRadius: 4,
                        stack: 'stack1'
                    }
                ]
            };

            const config = {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // Horizontal bar is often better for this comparison
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                callback: function (value) {
                                    return 'Â¥' + value.toLocaleString();
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        label += new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format(context.parsed.x);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            display: false // Using custom legend in HTML for cleaner look
                        }
                    }
                }
            };

            if (chart) {
                chart.data = data;
                chart.update();
            } else {
                chart = new Chart(ctx, config);
            }
        }

        // Event Listeners
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', calculate);
        });

        // Initial Calculation
        calculate();

    </script>
</body>

</html>