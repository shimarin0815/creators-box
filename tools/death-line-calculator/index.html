<!DOCTYPE html>
<html lang="ja">

<head>
    <script>
        // GA4 Tag: Only active on production domain
        if (window.location.hostname === "creators-box.net") {
            var script = document.createElement('script');
            script.async = true;
            script.src = "https://www.googletagmanager.com/gtag/js?id=G-WXMCP3D8W6";
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-WXMCP3D8W6');
        } else {
            console.log("GA4: ローカル/プレビュー環境のため計測をスキップしました");
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Death-Line Calculator | CPO損益分岐点シミュレーター</title>
    <meta name="description" content="LTVとコスト構造から、ビジネスが赤字転落する「限界CPO（撤退ライン）」を算出。現在の広告運用が安全圏か危険水域かを可視化するシミュレーター。">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            850: '#1e293b',
                        }
                    }
                },
            },
        }
    </script>
    <style>
        /* Custom styles for range inputs if needed */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 min-h-screen font-sans">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-30">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <a href="../../index.html" class="flex items-center gap-2 group">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                    class="text-slate-400 group-hover:text-blue-600 transition-colors">
                    <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <span class="font-bold text-slate-700 group-hover:text-slate-900 transition-colors">Creators Box</span>
            </a>
            <h1 class="text-lg font-bold text-slate-900 hidden md:block">The Death-Line Calculator</h1>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 md:py-12 max-w-6xl">

        <div class="mb-8">
            <h1 class="text-2xl md:text-3xl font-extrabold text-slate-900 mb-2">The Death-Line Calculator</h1>
            <p class="text-slate-600">撤退ライン（限界CPO）を可視化する損益分岐点シミュレーター</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- Input Area -->
            <div class="lg:col-span-5 bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8 h-fit">
                <h2 class="text-lg font-bold text-slate-900 mb-6 flex items-center gap-2">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="text-blue-600">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    パラメータ設定
                </h2>

                <div class="space-y-6">
                    <!-- LTV Input -->
                    <div>
                        <label for="ltv" class="block text-sm font-semibold text-slate-700 mb-2">LTV (顧客生涯価値)</label>
                        <div class="relative">
                            <input type="number" id="ltv" value="10000"
                                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-lg"
                                placeholder="10000">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">円</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">1人の顧客が生涯でもたらす平均売上</p>
                    </div>

                    <!-- Variable Cost Ratio Input -->
                    <div>
                        <label for="variableRate"
                            class="block text-sm font-semibold text-slate-700 mb-2">原価率・変動費率</label>
                        <div class="relative">
                            <input type="number" id="variableRate" value="30"
                                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-lg"
                                placeholder="30">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">%</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">売上に対する原価、決済手数料、送料などの割合</p>
                    </div>

                    <!-- Current CPO Input -->
                    <div>
                        <label for="currentCpo" class="block text-sm font-semibold text-slate-700 mb-2">現在のCPO
                            (顧客獲得単価)</label>
                        <div class="relative">
                            <input type="number" id="currentCpo" value="3000"
                                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-lg"
                                placeholder="3000">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">円</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">現在、1件の獲得にかかっている広告コスト</p>
                    </div>

                    <!-- Target Profit Ratio Input -->
                    <div>
                        <label for="targetProfitRate" class="block text-sm font-semibold text-slate-700 mb-2">目標利益率
                            (任意)</label>
                        <div class="relative">
                            <input type="number" id="targetProfitRate" value="20"
                                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-lg"
                                placeholder="20">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">%</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-1">最低限確保したい利益率（推奨ライン計算用）</p>
                    </div>
                </div>
            </div>

            <!-- Result Area -->
            <div class="lg:col-span-7 space-y-6">

                <!-- Status Card -->
                <div id="statusCard"
                    class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8 flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden transition-colors duration-300">
                    <div class="flex-1 z-10">
                        <span class="text-sm font-bold tracking-wider uppercase opacity-70 mb-1 block"
                            id="statusLabel">Analysing...</span>
                        <h3 class="text-3xl md:text-4xl font-extrabold" id="statusText">---</h3>
                        <p class="mt-2 text-sm opacity-90" id="statusMessage">数値を入力してください</p>
                    </div>
                    <!-- Icon placeholder -->
                    <div class="z-10 bg-white/20 p-4 rounded-full backdrop-blur-sm">
                        <span class="text-4xl" id="statusIcon">🤔</span>
                    </div>
                    <!-- Background decor -->
                    <div
                        class="absolute right-0 top-0 w-64 h-64 bg-current opacity-5 rounded-full -translate-y-1/2 translate-x-1/2 pointer-events-none">
                    </div>
                </div>

                <!-- Lines Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Death Line -->
                    <div class="bg-white rounded-xl shadow-sm border border-red-100 p-5 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-24 h-24 bg-red-100 rounded-bl-full -mr-8 -mt-8 opacity-50">
                        </div>
                        <h4 class="text-sm font-bold text-red-600 mb-1">限界CPO (Death Line)</h4>
                        <div class="text-2xl font-bold text-slate-800 font-mono"><span id="deathLineCpo">0</span><span
                                class="text-sm font-normal text-slate-500 ml-1">円</span></div>
                        <p class="text-xs text-slate-500 mt-2">これ以上かけると赤字になるライン</p>
                    </div>

                    <!-- Profit Line -->
                    <div class="bg-white rounded-xl shadow-sm border border-emerald-100 p-5 relative overflow-hidden">
                        <div
                            class="absolute top-0 right-0 w-24 h-24 bg-emerald-100 rounded-bl-full -mr-8 -mt-8 opacity-50">
                        </div>
                        <h4 class="text-sm font-bold text-emerald-600 mb-1">推奨CPO (Profit Line)</h4>
                        <div class="text-2xl font-bold text-slate-800 font-mono"><span id="profitLineCpo">0</span><span
                                class="text-sm font-normal text-slate-500 ml-1">円</span></div>
                        <p class="text-xs text-slate-500 mt-2">目標利益を達成できる上限コスト</p>
                    </div>
                </div>

                <!-- Chart -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                    <h3 class="font-bold text-slate-800 mb-4">収支構造ビジュアル</h3>
                    <div class="h-64 md:h-80 w-full">
                        <canvas id="profitChart"></canvas>
                    </div>
                    <div class="mt-4 flex flex-wrap gap-4 text-xs text-slate-500 justify-center">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-slate-200"></span>変動費
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-blue-500"></span>現在CPO
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-emerald-400"></span>残利益
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- SEO Content Article -->
    <article class="container mx-auto px-4 max-w-4xl mb-12">
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <details class="group">
                <summary
                    class="flex items-center justify-between p-6 md:p-8 cursor-pointer bg-slate-50 hover:bg-slate-100 transition-colors">
                    <div class="flex items-center gap-3">
                        <div class="bg-indigo-100 p-2 rounded-full text-blue-600">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                        </div>
                        <h2 class="text-lg md:text-xl font-bold text-slate-800">「撤退ライン」を知らないと危険！？なぜこの計算機が必要なのか？
                            (クリックで読む)
                        </h2>
                    </div>
                    <svg class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </summary>

                <div class="p-8 md:p-12 border-t border-slate-200 space-y-8 text-slate-600 leading-relaxed">
                    <section>
                        <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="w-1 h-6 bg-blue-600 rounded-full"></span>
                            ROASだけ見ていると陥る「赤字の罠」
                        </h3>
                        <p>
                            広告運用やマーケティングにおいて、多くの人が「ROAS（広告費用対効果）」を指標にします。しかし、<strong>ROASが良くても、実は赤字</strong>というケースは珍しくありません。<br>
                            なぜなら、ビジネスには広告費以外にも「原価」「送料」「決済手数料」「人件費」などのコストがかかっているからです。
                        </p>
                        <p class="mt-4">
                            この「The Death-Line
                            Calculator」は、LTV（顧客生涯価値）とコスト構造から、<strong>「これ以上広告費をかけたら100%赤字になるライン（限界CPO）」</strong>を正確に計算・可視化するためのツールです。
                        </p>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="w-1 h-6 bg-blue-600 rounded-full"></span>
                            用語解説：ビジネスを数字で把握する
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                                <h4 class="font-bold text-slate-800 mb-2">LTV (Life Time Value)</h4>
                                <p class="text-sm">顧客生涯価値。1人の顧客が取引期間を通じて企業にもたらす売上の総額。単品通販などでは「平均購入単価 × 平均購入回数」で算出します。
                                </p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                                <h4 class="font-bold text-slate-800 mb-2">CPO (Cost Per Order)</h4>
                                <p class="text-sm">顧客獲得単価。1件の注文（新規顧客）を獲得するためにかかった広告費用。「広告費 ÷ 獲得件数」で算出します。</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                                <h4 class="font-bold text-red-700 mb-2">限界CPO (Death Line)</h4>
                                <p class="text-sm">損益分岐点となるCPO。LTVから変動費（原価など）を引いた金額。これを超えると、売れば売るほど赤字になります。</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                                <h4 class="font-bold text-emerald-700 mb-2">推奨CPO (Profit Line)</h4>
                                <p class="text-sm">会社として確保したい利益を残すためのCPO上限。限界CPOから、さらに目標利益額を引いた金額です。</p>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <span class="w-1 h-6 bg-blue-600 rounded-full"></span>
                            計算結果が「DANGER」になったら？
                        </h3>
                        <p>
                            シミュレーション結果が<span class="text-red-600 font-bold">DANGER（赤字）</span>になった場合、ビジネスモデルの構造改革が必要です。
                        </p>
                        <ul class="list-disc pl-5 mt-4 space-y-2 marker:text-blue-500">
                            <li>
                                <strong>CPOを下げる:</strong> クリエイティブの改善、ターゲットの見直し、LP（ランディングページ）の成約率アップなどを行い、獲得コストを下げます。
                            </li>
                            <li>
                                <strong>LTVを上げる:</strong> アップセル・クロスセルの提案、リピート施策の強化、商品単価の見直しなどを行い、1顧客あたりの売上を増やします。
                            </li>
                            <li>
                                <strong>変動費を下げる:</strong> 原価低減、配送コストの見直しなどを行います。
                            </li>
                        </ul>
                    </section>

                    <section class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                        <h4 class="font-bold text-blue-800 mb-2">豆知識：SaaSと単品通販の違い</h4>
                        <p class="text-sm text-blue-900/80">
                            一般的に、SaaS（月額課金）ビジネスはLTVが高くなりやすいため、CPO（CAC）が高くても許容される傾向があります。一方、単品通販や物販は原価率が高いため、限界CPO（Death
                            Line）は低くなりやすく、よりシビアな広告運用が求められます。<br>
                            自分のビジネスモデルに合わせて数値を入力し、安全圏を把握しましょう。
                        </p>
                    </section>
                </div>
            </details>
        </div>
    </article>

    <!-- Footer -->
    <footer class="bg-white py-8 border-t border-slate-200 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-slate-500 text-sm mb-4">
                ※このシミュレーション結果は目安です。実際の経営判断は専門家にご相談ください。<br>
                データはブラウザ内で処理され、外部サーバーには送信されません。
            </p>
            <p class="text-slate-400 text-xs">&copy; 2025 Creators Box</p>
        </div>
    </footer>

    <script>
        // DOM Elements
        const inputs = {
            ltv: document.getElementById('ltv'),
            variableRate: document.getElementById('variableRate'),
            currentCpo: document.getElementById('currentCpo'),
            targetProfitRate: document.getElementById('targetProfitRate')
        };

        const outputs = {
            card: document.getElementById('statusCard'),
            label: document.getElementById('statusLabel'),
            text: document.getElementById('statusText'),
            message: document.getElementById('statusMessage'),
            icon: document.getElementById('statusIcon'),
            deathLine: document.getElementById('deathLineCpo'),
            profitLine: document.getElementById('profitLineCpo')
        };

        let chart = null;

        // Formats
        const formatCurrency = (num) => new Intl.NumberFormat('ja-JP').format(Math.round(num));

        // Calculation Logic
        function calculate() {
            const ltv = parseFloat(inputs.ltv.value) || 0;
            const variableRate = parseFloat(inputs.variableRate.value) || 0;
            const currentCpo = parseFloat(inputs.currentCpo.value) || 0;
            const targetProfitRate = parseFloat(inputs.targetProfitRate.value) || 0;

            // Basic Calcs
            const variableCost = ltv * (variableRate / 100);
            const targetProfitAmount = ltv * (targetProfitRate / 100);

            // Lines
            const deathLineCpo = ltv - variableCost; // Break-even CPO
            const profitLineCpo = ltv - variableCost - targetProfitAmount; // Target CPO

            // Profit Calculation
            const currentTotalCost = variableCost + currentCpo;
            const currentProfit = ltv - currentTotalCost;

            updateUI(ltv, variableCost, currentCpo, currentProfit, deathLineCpo, profitLineCpo, targetProfitAmount);
            updateChart(ltv, variableCost, currentCpo, currentProfit);
        }

        function updateUI(ltv, variableCost, currentCpo, currentProfit, deathLineCpo, profitLineCpo, targetProfitAmount) {
            // Update Number Displays
            outputs.deathLine.textContent = formatCurrency(deathLineCpo);
            outputs.profitLine.textContent = formatCurrency(profitLineCpo);

            // Determine Status
            let status = '';

            // Remove previous color classes
            outputs.card.className = "bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8 flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden transition-colors duration-300";

            if (currentCpo > deathLineCpo) {
                // DANGER: Deficit
                status = 'DANGER';
                outputs.card.classList.add('bg-red-50', 'border-red-200', 'text-red-900');
                outputs.label.textContent = "Current Status";
                outputs.text.textContent = "DANGER";
                outputs.message.textContent = `赤字発生中！1件獲得ごとに ${formatCurrency(Math.abs(currentProfit))}円 の損失です。即時撤退かLTV改善が必要です。`;
                outputs.icon.textContent = "😱";
            } else if (currentCpo > profitLineCpo) {
                // WARNING: Profitable but below target
                status = 'WARNING';
                outputs.card.classList.add('bg-amber-50', 'border-amber-200', 'text-amber-900');
                outputs.label.textContent = "Current Status";
                outputs.text.textContent = "WARNING";
                outputs.message.textContent = `黒字ですが目標利益率(${inputs.targetProfitRate.value}%)を下回っています。利益圧迫の懸念があります。`;
                outputs.icon.textContent = "⚠️";
            } else {
                // EXCELLENT: Meeting target
                status = 'EXCELLENT';
                outputs.card.classList.add('bg-indigo-50', 'border-indigo-200', 'text-indigo-900');
                outputs.label.textContent = "Current Status";
                outputs.text.textContent = "EXCELLENT";
                outputs.message.textContent = `素晴らしい！目標利益を確保できています。さらにアクセルを踏める状態です。`;
                outputs.icon.textContent = "🚀";
            }
        }

        function updateChart(ltv, variableCost, currentCpo, currentProfit) {
            const ctx = document.getElementById('profitChart').getContext('2d');

            // Data prep
            // To visualize nicely, if profit is negative (loss), we show red bar extending beyond LTV?
            // Or simple stacked bar of LTV breakdown.

            // Approach: Stacked Bar. 
            // Bar 1: Total Revenue (LTV)
            // Bar 2: Costs Stack (Variable + CPO + Profit/Loss)

            let profitBarValue = currentProfit > 0 ? currentProfit : 0;
            let lossBarValue = currentProfit < 0 ? Math.abs(currentProfit) : 0;

            const data = {
                labels: ['LTV (売上)', 'コスト構造'],
                datasets: [
                    {
                        label: 'LTV / 変動費',
                        data: [ltv, variableCost],
                        backgroundColor: '#e2e8f0', // slate-200
                        borderRadius: 4,
                        stack: 'stack1'
                    },
                    {
                        label: '広告費 (CPO)',
                        data: [0, currentCpo],
                        backgroundColor: '#3b82f6', // blue-500
                        borderRadius: 4,
                        stack: 'stack1'
                    },
                    {
                        label: '利益',
                        data: [0, profitBarValue],
                        backgroundColor: '#34d399', // emerald-400
                        borderRadius: 4,
                        stack: 'stack1'
                    },
                    {
                        label: '赤字',
                        data: [0, lossBarValue], // Shows on top if loss
                        backgroundColor: '#ef4444', // red-500
                        borderRadius: 4,
                        stack: 'stack1'
                    }
                ]
            };

            const config = {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // Horizontal bar is often better for this comparison
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                callback: function (value) {
                                    return '¥' + value.toLocaleString();
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        label += new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format(context.parsed.x);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            display: false // Using custom legend in HTML for cleaner look
                        }
                    }
                }
            };

            if (chart) {
                chart.data = data;
                chart.update();
            } else {
                chart = new Chart(ctx, config);
            }
        }

        // Event Listeners
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', calculate);
        });

        // Initial Calculation
        calculate();

    </script>
</body>

</html>